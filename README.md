# Yandex-Lyceum-Golang-Sprint-2
Если есть вопросы пишите https://t.me/voronkovmaksim

[Наглядная блок схема](https://excalidraw.com/#json=W4xvipJ-gpFpYh0iEUP3i,o4eFkMY-bD6lHyqx7s8wjQ)

![Безымянный-2024-02-16-1918](https://github.com/Zyvexa/Yandex-Lyceum-Golang-Sprint-2/assets/75199334/3531e044-b9ca-4b2d-85b1-0d80ba183353)

Как это устроено: 


У меня все реализовано в консоле, без графического интерфейса. Есть оркестратор и неограниченное количество агентов, для хранения информации используются csv. У меня не сделаны перезапуски. Мониторинг агентов есть, можно узнать на каких портах работают агенты, крайнее время, когда с ними была связь, сколько операций они выполняют сейчас и их максимальное количество операций.
Теперь по порядку, оркестратор запускается на порту 8080, он распределяет все задачи между агентами, с помощью POST запрса передаем оркестратору json файл, с выражением, которое нужно посчитать и с длительностью выполнения операций. С помощью get запроса можно узнать статус выражения, которое было отправленно оркестратору, или узнать состояние агентов. После того как оркестратор получил выражение запускается горутина где он сначало проверяет правильность ввода выражения, затем переводит в постфиксную форму для простоты подсчета и начинает считать. Для подсчета чего либо оркестратор формирует json с операндами, операцией и длительностью выполнения действий, и отправляет его в так называемы long list, в нем выражения ждут пока их распределят на свободного агента, т.к. Свободного агента может не быть для этого и сделан long list. Выражение приходит агенту он его проверяет и запускает горутину с вычислением, после вычисления он записывает ответ в answer.csv, откуда его позже получает оркестратор и продолжает вычисления, после того, как он выполнил вычисления и получил финальный ответ значение записывается в файл  expression.csv, в нем также хранится основная информация про это выражение. В то время как выражения вычисляется пользователь может наблюдать в реальном времени за состоянием агентов, их занятостью. 

Мои комментарии по критериям: 

0. -
1. Программа запускается и считает, она может считать простые выражения с одним действием, сложные, воспринимает скоби, возведение в степень - ^, Но между всем должен быть пробел и только 1, например “( 2 + 2 ) ^ 2” - правильно , “ (12 + 2) ^ 2” - не правильно (нет пробеле между цифрой и скобкой , вот еще несколько примеров ввода:   . 
2. Программа может отрабатывать и произвольные примеры, но важно следить за корректностью ввода, в большинстве случаев ошибка в вводе будет замечена, но при незамеченной ошибке ответ может быть неправильным, но это маловероятно. 
3. Нет
4. Нет 
5. Мониторинг воркеров реализован, можно увидеть на каком порту он находится, когда последний раз выходил на связь, сколько задач сейчас и максимальное количество задач. Если в данный момент на агенте не выполняются вычисления, его можно отключить и через 5 мин он пропадет из списка агентов.
6. Нет 
7. -
8. [Наглядная блок схема](https://excalidraw.com/#json=W4xvipJ-gpFpYh0iEUP3i,o4eFkMY-bD6lHyqx7s8wjQ)
9. Да, у меня реализована функция, которая автоматически распределяет задачи по свободным агентам, не важно что за задача и что за агент. 

Как это запустить:
1. Нужно зайти в agent.go  (строка 184 и 185), указать полный путь к файлам agent.csv и answer.csv
2. Нужно зайти в main.go (строки 923 - 926), указать полный путь к файлам, тут это не обязательно он вроде и так работает(но для 100% уверенность лучше указать), но в agent.go это нужно сделать. 
3. Открываете cmd (win + r, cmd) переходите в /Main и запускаете "go run main.go" , сейчас вы запустили оркестратор, оставляете окно открытым 
4. Запускаете еще одно окно cmd переходите в /Agent, "go run agent.go" , указываете максимальное количество одновременных операций, агент запущен. Это можно повторить несколько раз чтобы запустить несколько агентов
5. Запускаете еще одно окно cmd в этой папке (там где csv лежат), с помощью этого окна будем отправлять запросы.

Как этим  пользоваться. 
Вот все что нужно для этого (запускать в cmd): 
1. "curl http://localhost:8080/agents" - по этому get запросу к вам придут данные про агентов, есть 4 колонки (port,last_time,free,total), port - порт на котором открыт агент, last_time - последнее время связи с агентом, free - количество занятых мощностей агента, total - общее количество мощностей агента.
2. "curl http://localhost:8080/expressions"  - по этому get запросу к вам придут данные про все выражения, expression - само выражение,id - его уникальный id,time in - время отправления выражения,time out - время когда она посчиталось,answer - ответ,error - ошибка (200. Выражение успешно принято, распаршено и принято к обработке. 400. Выражение невалидно. 500. Что-то не так на back-end.)
Для изменения времени выполнения операции необходимо поменять время в time.json в секундах, 
{
    "timeAddition": 15,       - сумма
    "timeSubtraction": 15,    - разность 
    "timeMultiplication": 15, - умножение 
    "timeDivision": 15,       - деление 
    "timeExponentiation": 15  - возведение в степень
}
4. "curl -X POST -d @time.json http://localhost:8080/time" - после выполнения этой команды файл отправится к оркестратору. 
5. Само выражение необходимо записать в expression.json и отправить из cmd при помощи следующей команды: 
"curl -X POST -d @expression.json http://localhost:8080/expression"


P.S. для более удобной и быстрой  проверки я рекомендую вам открыть в vscode всю папку, в верхне панеле открыть agent.csv, expression.csv(результат подсчеты выражений), main.go (запустить его в vccode без cmd), commands.txt ( для удобного копирования команд) и json файлы для быстрого изменения, а через cmd открыть агентов и отправлять запросы. В CSV можно будет сразу же смотреть ответы без доп вызова функций. 

